(function(){fdTableSort={regExp_Currency:/^[£$€¥¤]/,regExp_Number:/^(\-)?[0-9]+(\.[0-9]*)?$/,pos:-1,uniqueHash:1,thNode:null,tableId:null,tableCache:{},tmpCache:{},sortActiveClass:"sort-active",colspan:"colspan",rowspan:"rowspan",addEvent:function(e,t,n,r){r||(r=true);if(e.attachEvent){e["e"+t+n]=n;e[t+n]=function(){e["e"+t+n](window.event)};e.attachEvent("on"+t,e[t+n])}else{e.addEventListener(t,n,true)}},removeEvent:function(e,t,n,r){r||(r=true);try{if(e.detachEvent){e.detachEvent("on"+t,e[t+n]);e[t+n]=null}else{e.removeEventListener(t,n,true)}}catch(i){}},stopEvent:function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();e.preventDefault()}return false},parseClassName:function(e,t){var n=t.className.match(new RegExp(e+"((-[\\d]+([r]){0,1})+)"));return n&&n.length?n[0].replace(e,"").split("-"):[]},disableSelection:function(e){e.onselectstart=function(){return false};e.unselectable="on";e.style.MozUserSelect="none"},removeTableCache:function(e){if(!(e in fdTableSort.tableCache))return;fdTableSort.tableCache[e]=null;delete fdTableSort.tableCache[e];var t=document.getElementById(e);if(!t)return;var n=t.getElementsByTagName("th");var r;for(var i=0,s;s=n[i];i++){r=s.getElementsByTagName("a");if(r.length)r[0].onkeydown=r[0].onclick=null;s.onclick=s.onselectstart=s=r=null}},removeTmpCache:function(e){if(!(e in fdTableSort.tmpCache))return;var t=fdTableSort.tmpCache[e].headers;var n;for(var r=0,i;i=t[r];r++){for(var s=0,o;o=i[s];s++){n=o.getElementsByTagName("a");if(n.length)n[0].onkeydown=n[0].onclick=null;o.onclick=o.onselectstart=o=n=null}}fdTableSort.tmpCache[e]=null;delete fdTableSort.tmpCache[e]},initEvt:function(e){fdTableSort.init(false)},init:function(e){if(!document.getElementsByTagName||!document.createElement||!document.getElementById)return;var t=e&&document.getElementById(e)?[document.getElementById(e)]:document.getElementsByTagName("table");var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;var N=document.createElement("a");N.href="#";N.className="fdTableSortTrigger";var C=document.createElement("span");for(var k=0,L;L=t[k];k++){if(L.id){fdTableSort.removeTableCache(L.id);fdTableSort.removeTmpCache(L.id)}y=L.getElementsByTagName("thead").length?L.getElementsByTagName("thead")[0].getElementsByTagName("tr"):L.getElementsByTagName("tr");b=[];w=false;for(var A=0,O;O=y[A];A++){if(O.getElementsByTagName("td").length||!O.getElementsByTagName("th").length){continue}b[b.length]=O.getElementsByTagName("th");for(var M=0,_;_=b[b.length-1][M];M++){if(_.className.search(/sortable/)!=-1){w=true}}}if(!w)continue;if(!L.id){L.id="fd-table-"+fdTableSort.uniqueHash++}a=L.className.search("no-arrow")==-1;o=L.className.search("sortable-onload-show")!=-1;f={};s=fdTableSort.parseClassName(o?"sortable-onload-show":"sortable-onload",L);for(u=1;u<s.length;u++){f[parseInt(s[u],10)]={reverse:s[u].search("r")!=-1}}T=b[0].length;for(n=0;n<b[0].length;n++){if(b[0][n].getAttribute(fdTableSort.colspan)&&b[0][n].getAttribute(fdTableSort.colspan)>1){T=T+(b[0][n].getAttribute(fdTableSort.colspan)-1)}}c=new Array(b.length);for(n=b.length;n--;){c[n]=new Array(T)}for(n=0;n<c.length;n++){E=0;for(A=0;A<T;A++){if(!c[n][A]){g=b[n][E];S=g.getAttribute(fdTableSort.colspan)>1?g.getAttribute(fdTableSort.colspan):1;x=g.getAttribute(fdTableSort.rowspan)>1?g.getAttribute(fdTableSort.rowspan):1;for(var D=0;D<S&&A+D<T;D++){for(var P=0;P<x&&n+P<c.length;P++){c[n+P][A+D]=g}}if(++E==b[n].length)break}}}for(n=0;n<c.length;n++){for(A=0;A<c[n].length;A++){if(c[n][A].className.search("fd-column-")==-1&&c[n][A].className.search("sortable")!=-1)c[n][A].className=c[n][A].className+" fd-column-"+A;if(c[n][A].className.match("sortable")){c[n][A].className=c[n][A].className.replace(/forwardSort|reverseSort/,"");if(A in f){f[A]["thNode"]=c[n][A];f["active"]=true}p=fdTableSort.getInnerText(c[n][A],true);for(var H=c[n][A].childNodes.length;H--;){if(c[n][A].childNodes[H].nodeType==1&&(c[n][A].childNodes[H].className=="fdFilterTrigger"||/img/i.test(c[n][A].childNodes[H].nodeName))){continue}if(c[n][A].childNodes[H].nodeType==1&&/^a$/i.test(c[n][A].childNodes[H].nodeName)){c[n][A].childNodes[H].onclick=c[n][A].childNodes[H].onkeydown=null}c[n][A].removeChild(c[n][A].childNodes[H])}d=N.cloneNode(true);d.innerHTML=p;d.title="Sort on “"+p.replace("<br />","")+"”";d.onclick=d.onkeydown=c[n][A].onclick=fdTableSort.initWrapper;c[n][A].appendChild(d);if(a)c[n][A].appendChild(C.cloneNode(false));c[n][A].className=c[n][A].className.replace(/fd-identical|fd-not-identical/,"");fdTableSort.disableSelection(c[n][A]);d=null}}}fdTableSort.tmpCache[L.id]={cols:T,headers:c};c=null;v=0;if("active"in f){fdTableSort.tableId=L.id;fdTableSort.prepareTableData(document.getElementById(fdTableSort.tableId));delete f["active"];for(col in f){l=f[col];if(!("thNode"in l)){continue}fdTableSort.multi=true;i=l.reverse?2:1;for(r=0;r<i;r++){fdTableSort.thNode=l.thNode;if(!o){fdTableSort.initSort(false,true)}else{fdTableSort.addThNode()}}if(o){fdTableSort.removeClass(l.thNode,"(forwardSort|reverseSort)");fdTableSort.addClass(l.thNode,l.reverse?"reverseSort":"forwardSort");if(a){C=fdTableSort.thNode.getElementsByTagName("span")[0];if(C.firstChild){C.removeChild(C.firstChild)}C.appendChild(document.createTextNode(i==1?" ↓":" ↑"))}}}if(o&&(fdTableSort.tableCache[L.id].colStyle||fdTableSort.tableCache[L.id].rowStyle)){fdTableSort.redraw(L.id,false)}}else if(L.className.search(/onload-zebra/)!=-1){fdTableSort.tableId=L.id;fdTableSort.prepareTableData(L);if(fdTableSort.tableCache[L.id].rowStyle){fdTableSort.redraw(L.id,false)}}}fdTableSort.thNode=d=N=C=f=thNode=L=y=b=null},initWrapper:function(e){e=e||window.event;var t=e.type=="keydown"?e.keyCode!=null?e.keyCode:e.charCode:-1;if(fdTableSort.thNode==null&&(e.type=="click"||t==13)){var n=this;while(n.tagName.toLowerCase()!="th"){n=n.parentNode}fdTableSort.thNode=n;while(n.tagName.toLowerCase()!="table"){n=n.parentNode}fdTableSort.tableId=n.id;fdTableSort.multi=e.shiftKey;fdTableSort.addSortActiveClass();setTimeout(fdTableSort.initSort,5,false);return fdTableSort.stopEvent(e)}return t!=-1?true:fdTableSort.stopEvent(e)},jsWrapper:function(e,t){if(!(e in fdTableSort.tmpCache)){return false}if(!(e in fdTableSort.tableCache)){fdTableSort.prepareTableData(document.getElementById(e))}if(!(t instanceof Array)){t=[t]}fdTableSort.tableId=e;var n=t.length,r;if(fdTableSort.tableCache[e].thList.length==t.length){var i=true;var s;for(var o=0;o<n;o++){r=t[o];s=fdTableSort.tmpCache[e].headers[0][r];if(s!=fdTableSort.tableCache[e].thList[o]){i=false;break}}if(i){fdTableSort.thNode=s;fdTableSort.initSort(true);return}}fdTableSort.addSortActiveClass();for(var o=0;o<n;o++){fdTableSort.multi=o;r=t[o];fdTableSort.thNode=fdTableSort.tmpCache[e].headers[0][r];fdTableSort.initSort(true)}},addSortActiveClass:function(){if(fdTableSort.thNode==null){return}fdTableSort.addClass(fdTableSort.thNode,fdTableSort.sortActiveClass);fdTableSort.addClass(document.getElementsByTagName("body")[0],fdTableSort.sortActiveClass)},removeSortActiveClass:function(){if(fdTableSort.thNode==null)return;fdTableSort.removeClass(fdTableSort.thNode,fdTableSort.sortActiveClass);fdTableSort.removeClass(document.getElementsByTagName("body")[0],fdTableSort.sortActiveClass)},doCallback:function(e){if(!fdTableSort.tableId||!(fdTableSort.tableId in fdTableSort.tableCache)){return}fdTableSort.callback(fdTableSort.tableId,e?fdTableSort.tableCache[fdTableSort.tableId].initiatedCallback:fdTableSort.tableCache[fdTableSort.tableId].completeCallback)},addClass:function(e,t){if((new RegExp("(^|\\s)"+t+"(\\s|$)")).test(e.className)){return}e.className+=(e.className?" ":"")+t},removeClass:function(e,t){e.className=!t?"":e.className.replace(new RegExp("(^|\\s)"+t+"(\\s|$)")," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},callback:function(e,t){var n,r;try{if(t.indexOf(".")!=-1){r=t.split(".");obj=window;for(var i=0,s;s=obj[r[i]];i++){if(s instanceof Function){(function(){var e=s;n=function(t){e.apply(obj,[t])}})()}else{obj=s}}}else if(t+e in window){n=window[t+e]}else if(t in window){n=window[t]}else{n=null}}catch(o){}if(!(n instanceof Function))return;n(e,fdTableSort.tableCache[e].thList)},prepareTableData:function(e){var t=[];var n=e.getElementsByTagName("tbody");n=n.length?n[0]:e;var r=n.rows;var i=e.getElementsByTagName("th");var s=r.length;var o=fdTableSort.tmpCache[e.id].cols;var t=[];var u=new Array(o);var a=new Array(o);for(var f=0;f<o;f++)u[f]=true;var l,c,h,p,d,v,m;var g=new RegExp(/fd-column-([0-9]+)/);var y=0;var b=[];for(var f=0,h;h=i[f];f++){if(h.className.search(g)==-1)continue;b[b.length]=h}for(m=0;m<s;m++){l=r[m];if(l.parentNode!=n||l.getElementsByTagName("th").length||l.parentNode&&l.parentNode.tagName.toLowerCase().search(/thead|tfoot/)!=-1)continue;t[y]=[];d=l.cells;for(var f=0,h;h=b[f];f++){v=h.className.match(g)[1];c=d[v];p=fdTableSort.getInnerText(c)+" ";p=p.replace(/^\s+/,"").replace(/\s+$/,"");if(h.className.search(/sortable-date/)!=-1){p=fdTableSort.dateFormat(p,h.className.search(/sortable-date-dmy/)!=-1)}else if(h.className.search(/sortable-numeric|sortable-currency/)!=-1){p=parseFloat(p.replace(/[^0-9\.\-]/g,""));if(isNaN(p))p=""}else if(h.className.search(/sortable-text/)!=-1){p=p.toLowerCase()}else if(h.className.search(/sortable-keep/)!=-1){p=y}else if(h.className.search(/sortable-([a-zA-Z\_]+)/)!=-1){if(h.className.match(/sortable-([a-zA-Z\_]+)/)[1]+"PrepareData"in window){p=window[h.className.match(/sortable-([a-zA-Z\_]+)/)[1]+"PrepareData"](c,p)}}else if(p!=""){fdTableSort.removeClass(h,"sortable");if(fdTableSort.dateFormat(p)!=0){fdTableSort.addClass(h,"sortable-date");p=fdTableSort.dateFormat(p)}else if(p.search(fdTableSort.regExp_Number)!=-1||p.search(fdTableSort.regExp_Currency)!=-1){fdTableSort.addClass(h,"sortable-numeric");p=parseFloat(p.replace(/[^0-9\.\-]/g,""));if(isNaN(p))p=""}else{fdTableSort.addClass(h,"sortable-text");p=p.toLowerCase()}}if(y>0&&u[v]&&a[v]!=p){u[v]=false}a[v]=p;t[y][v]=p}t[y][o]=l;y++}var w=e.className.search(/colstyle-([\S]+)/)!=-1?e.className.match(/colstyle-([\S]+)/)[1]:false;var E=e.className.search(/rowstyle-([\S]+)/)!=-1?e.className.match(/rowstyle-([\S]+)/)[1]:false;var S=e.className.search(/sortinitiatedcallback-([\S-]+)/)==-1?"sortInitiatedCallback":e.className.match(/sortinitiatedcallback-([\S]+)/)[1];var x=e.className.search(/sortcompletecallback-([\S-]+)/)==-1?"sortCompleteCallback":e.className.match(/sortcompletecallback-([\S]+)/)[1];S=S.replace("-",".");x=x.replace("-",".");fdTableSort.tableCache[e.id]={hook:n,initiatedCallback:S,completeCallback:x,thList:[],colOrder:{},data:t,identical:u,colStyle:w,rowStyle:E,noArrow:e.className.search(/no-arrow/)!=-1};b=t=l=c=h=r=u=a=null},onUnload:function(){for(tbl in fdTableSort.tableCache){fdTableSort.removeTableCache(tbl)}for(tbl in fdTableSort.tmpCache){fdTableSort.removeTmpCache(tbl)}fdTableSort.removeEvent(window,"load",fdTableSort.initEvt);fdTableSort.removeEvent(window,"unload",fdTableSort.onUnload);fdTableSort.tmpCache=fdTableSort.tableCache=null},addThNode:function(){var e=fdTableSort.tableCache[fdTableSort.tableId];var t=fdTableSort.thNode.className.match(/fd-column-([0-9]+)/)[1];var n=false;if(!fdTableSort.multi){if(e.colStyle){var r=e.thList.length;for(var i=0;i<r;i++){e.colOrder[e.thList[i].className.match(/fd-column-([0-9]+)/)[1]]=false}}if(e.thList.length&&e.thList[0]==fdTableSort.thNode)n=true;e.thList=[]}var s=false;var o=e.thList.length;for(var i=0,u;u=e.thList[i];i++){if(u==fdTableSort.thNode){s=true;break}}if(!s){e.thList.push(fdTableSort.thNode);if(e.colStyle){e.colOrder[t]=true}}var a=document.getElementById(fdTableSort.tableId).getElementsByTagName("th");for(var i=0,f;f=a[i];i++){s=false;for(var l=0,u;u=e.thList[l];l++){if(u==f){s=true;break}}if(!s){fdTableSort.removeClass(f,"(forwardSort|reverseSort)");if(!e.noArrow){span=f.getElementsByTagName("span");if(span.length){span=span[0];while(span.firstChild)span.removeChild(span.firstChild)}}}}if(e.thList.length>1){classToAdd=fdTableSort.thNode.className.search(/forwardSort/)!=-1?"reverseSort":"forwardSort";fdTableSort.removeClass(fdTableSort.thNode,"(forwardSort|reverseSort)");fdTableSort.addClass(fdTableSort.thNode,classToAdd);e.pos=-1}else if(n){e.pos=fdTableSort.thNode}},initSort:function(noCallback,ident){var thNode=fdTableSort.thNode;var tableElem=document.getElementById(fdTableSort.tableId);if(!(fdTableSort.tableId in fdTableSort.tableCache)){fdTableSort.prepareTableData(document.getElementById(fdTableSort.tableId))}fdTableSort.addThNode();if(!noCallback){fdTableSort.doCallback(true)}fdTableSort.pos=thNode.className.match(/fd-column-([0-9]+)/)[1];var dataObj=fdTableSort.tableCache[tableElem.id];var lastPos=dataObj.pos&&dataObj.pos.className?dataObj.pos.className.match(/fd-column-([0-9]+)/)[1]:-1;var len1=dataObj.data.length;var len2=dataObj.data.length>0?dataObj.data[0].length-1:0;var identical=dataObj.identical[fdTableSort.pos];var classToAdd="forwardSort";if(dataObj.thList.length>1){var js="var sortWrapper = function(a,b) {\n";var l=dataObj.thList.length;var cnt=0;var e,d,th,p,f;for(var i=0;i<l;i++){th=dataObj.thList[i];p=th.className.match(/fd-column-([0-9]+)/)[1];if(dataObj.identical[p]){continue}cnt++;if(th.className.match(/sortable-(numeric|currency|date|keep)/)){f="fdTableSort.sortNumeric"}else if(th.className.match("sortable-text")){f="fdTableSort.sortText"}else if(th.className.search(/sortable-([a-zA-Z\_]+)/)!=-1&&th.className.match(/sortable-([a-zA-Z\_]+)/)[1]in window){f="window['"+th.className.match(/sortable-([a-zA-Z\_]+)/)[1]+"']"}else f="fdTableSort.sortText";e="e"+i;d=th.className.search("forwardSort")!=-1?"a,b":"b,a";js+="fdTableSort.pos   = "+p+";\n";js+="var "+e+" = "+f+"("+d+");\n";js+="if("+e+") return "+e+";\n";js+="else { \n"}js+="return 0;\n";for(var i=0;i<cnt;i++){js+="};\n"}if(cnt)js+="return 0;\n";js+="};\n";eval(js);dataObj.data.sort(sortWrapper);identical=false}else if(lastPos==fdTableSort.pos&&!identical||thNode.className.search(/sortable-keep/)!=-1&&lastPos==-1){dataObj.data.reverse();classToAdd=thNode.className.search(/reverseSort/)!=-1?"forwardSort":"reverseSort";if(thNode.className.search(/sortable-keep/)!=-1&&lastPos==-1)fdTableSort.tableCache[tableElem.id].pos=thNode}else{fdTableSort.tableCache[tableElem.id].pos=thNode;classToAdd=thNode.className.search(/forwardSort/)!=-1?"reverseSort":"forwardSort";if(!identical){if(thNode.className.match(/sortable-(numeric|currency|date|keep)/)){dataObj.data.sort(fdTableSort.sortNumeric)}else if(thNode.className.match("sortable-text")){dataObj.data.sort(fdTableSort.sortText)}else if(thNode.className.search(/sortable-([a-zA-Z\_]+)/)!=-1&&thNode.className.match(/sortable-([a-zA-Z\_]+)/)[1]in window){dataObj.data.sort(window[thNode.className.match(/sortable-([a-zA-Z\_]+)/)[1]])}if(thNode.className.search(/(^|\s)favour-reverse($|\s)/)!=-1){classToAdd=classToAdd=="forwardSort"?"reverseSort":"forwardSort";dataObj.data.reverse()}}}if(ident){identical=false}if(dataObj.thList.length==1){fdTableSort.removeClass(thNode,"(forwardSort|reverseSort)");fdTableSort.addClass(thNode,classToAdd)}if(!dataObj.noArrow){var span=fdTableSort.thNode.getElementsByTagName("span")[0];if(span.firstChild)span.removeChild(span.firstChild);span.appendChild(document.createTextNode(fdTableSort.thNode.className.search(/forwardSort/)!=-1?" ↓":" ↑"))}if(!dataObj.rowStyle&&!dataObj.colStyle&&identical){fdTableSort.removeSortActiveClass();if(!noCallback){fdTableSort.doCallback(false)}fdTableSort.thNode=null;return}if("tablePaginater"in window&&tablePaginater.tableIsPaginated(fdTableSort.tableId)){tablePaginater.redraw(fdTableSort.tableId,identical)}else{fdTableSort.redraw(fdTableSort.tableId,identical)}fdTableSort.removeSortActiveClass();if(!noCallback){fdTableSort.doCallback(false)}fdTableSort.thNode=null},redraw:function(e,t){if(!e||!(e in fdTableSort.tableCache)){return}var n=fdTableSort.tableCache[e];var r=n.data;var i=r.length;var s=i?r[0].length-1:0;var o=n.hook;var u=n.colStyle;var a=n.rowStyle;var f=n.colOrder;var l=0;var c=/(^|\s)invisibleRow(\s|$)/;var h,p;for(var d=0;d<i;d++){h=r[d][s];if(u){p=h.cells;for(thPos in f){if(!f[thPos])fdTableSort.removeClass(p[thPos],u);else fdTableSort.addClass(p[thPos],u)}}if(!t){if(a&&h.className.search(c)==-1){if(l++&1)fdTableSort.addClass(h,a);else fdTableSort.removeClass(h,a)}o.appendChild(h)}}h=p=o=null},getInnerText:function(e,t){if(typeof e=="string"||typeof e=="undefined")return e;if(e.innerText)return e.innerText;var n="",r;for(r=e.firstChild;r;r=r.nextSibling){if(t&&r.nodeName&&r.nodeName=="BR")n+="<br />";else if(r.nodeType==3)n+=r.nodeValue;else if(r.nodeType==1)n+=fdTableSort.getInnerText(r)}return n},dateFormat:function(e,t){var n=[{regExp:/^(0?[1-9]|1[012])([- \/.])(0?[1-9]|[12][0-9]|3[01])([- \/.])((\d\d)?\d\d)$/,d:3,m:1,y:5},{regExp:/^(0?[1-9]|[12][0-9]|3[01])([- \/.])(0?[1-9]|1[012])([- \/.])((\d\d)?\d\d)$/,d:1,m:3,y:5},{regExp:/^(\d\d\d\d)([- \/.])(0?[1-9]|1[012])([- \/.])(0?[1-9]|[12][0-9]|3[01])$/,d:5,m:3,y:1}];var r,i=0,s=n.length;while(i<s){r=(i+(t?s+1:s))%s;if(e.match(n[r].regExp)){res=e.match(n[r].regExp);y=res[n[r].y];m=res[n[r].m];d=res[n[r].d];if(m.length==1)m="0"+String(m);if(d.length==1)d="0"+String(d);if(y.length!=4)y=parseInt(y)<50?"20"+String(y):"19"+String(y);return y+String(m)+d}i++}return 0},sortNumeric:function(e,t){var n=e[fdTableSort.pos];var r=t[fdTableSort.pos];if(n==r)return 0;if(n===""&&!isNaN(r))return-1;if(r===""&&!isNaN(n))return 1;return n-r},sortText:function(e,t){var n=e[fdTableSort.pos];var r=t[fdTableSort.pos];if(n==r)return 0;if(n<r)return-1;return 1}}})();fdTableSort.addEvent(window,"load",fdTableSort.initEvt);fdTableSort.addEvent(window,"unload",fdTableSort.onUnload)